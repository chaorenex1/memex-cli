# çŠ¶æ€ç®¡ç†é›†æˆ - å¯è§†åŒ–æµç¨‹å›¾

æœ¬æ–‡æ¡£æä¾›æ”¹é€ å‰åçš„å¯è§†åŒ–å¯¹æ¯”ï¼Œå¸®åŠ©ç†è§£æ•´ä½“æ¶æ„å˜åŒ–ã€‚

## ğŸ“Š æ”¹é€ å‰ vs æ”¹é€ å

### æ”¹é€ å‰ï¼šåˆ†æ•£çš„çŠ¶æ€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 run_app_with_config()                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  let run_id = uuid::new_v4()                          â”‚  â”‚
â”‚  â”‚  let user_query = ...                                 â”‚  â”‚
â”‚  â”‚  âŒ çŠ¶æ€åˆ†æ•£åœ¨å±€éƒ¨å˜é‡ä¸­                              â”‚  â”‚
â”‚  â”‚  âŒ æ— æ³•å¤–éƒ¨æŸ¥è¯¢                                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  memory.search() â†’ matches                            â”‚  â”‚
â”‚  â”‚  âŒ matches åªåœ¨æœ¬åœ°ä¿å­˜                              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  run_session() â†’ run_result                           â”‚  â”‚
â”‚  â”‚  âŒ æ‰§è¡Œä¸­çŠ¶æ€ä¸å¯è§                                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  gatekeeper.evaluate() â†’ decision                     â”‚  â”‚
â”‚  â”‚  âŒ å†³ç­–åªåœ¨å‡½æ•°è¿”å›æ—¶å¯è§                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é—®é¢˜ï¼š
âŒ æ— ç»Ÿä¸€çŠ¶æ€ç®¡ç†
âŒ æ— æ³•å®æ—¶æŸ¥è¯¢è¿›åº¦
âŒ è°ƒè¯•å›°éš¾
âŒ æ— æ³•æ¢å¤çŠ¶æ€
```

### æ”¹é€ åï¼šé›†ä¸­çš„çŠ¶æ€ç®¡ç†

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   StateManager (å…¨å±€)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  AppState:                                            â”‚  â”‚
â”‚  â”‚  â€¢ active_sessions: 1                                 â”‚  â”‚
â”‚  â”‚  â€¢ completed_sessions: 42                             â”‚  â”‚
â”‚  â”‚                                                        â”‚  â”‚
â”‚  â”‚  Sessions:                                            â”‚  â”‚
â”‚  â”‚  â€¢ session_1: { phase: RunnerRunning, ... }          â”‚  â”‚
â”‚  â”‚  â€¢ session_2: { phase: Completed, ... }              â”‚  â”‚
â”‚  â”‚                                                        â”‚  â”‚
â”‚  â”‚  Event Broadcasting:                                  â”‚  â”‚
â”‚  â”‚  â€¢ SessionCreated â†’ Listeners                         â”‚  â”‚
â”‚  â”‚  â€¢ StateChanged â†’ Listeners                           â”‚  â”‚
â”‚  â”‚  â€¢ SessionCompleted â†’ Listeners                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â”‚ integrate
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 run_app_with_config()                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  âœ… session_id = manager.create_session()             â”‚  â”‚
â”‚  â”‚  âœ… çŠ¶æ€é›†ä¸­ç®¡ç†ï¼Œå¯æŸ¥è¯¢                              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  âœ… manager.transition(MemorySearch)                  â”‚  â”‚
â”‚  â”‚  memory.search() â†’ matches                            â”‚  â”‚
â”‚  â”‚  âœ… manager.update(memory_hits = matches.len())       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  âœ… manager.transition(RunnerRunning)                 â”‚  â”‚
â”‚  â”‚  run_session(state_manager) â†’ run_result             â”‚  â”‚
â”‚  â”‚     â””â”€> âœ… å®æ—¶æ›´æ–° tool_events_count                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  âœ… manager.transition(GatekeeperEvaluating)          â”‚  â”‚
â”‚  â”‚  gatekeeper.evaluate() â†’ decision                     â”‚  â”‚
â”‚  â”‚  âœ… manager.update(gatekeeper_decision = decision)    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  âœ… manager.complete(session_id, exit_code)           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ä¼˜åŠ¿ï¼š
âœ… ç»Ÿä¸€çŠ¶æ€ç®¡ç†
âœ… å®æ—¶çŠ¶æ€æŸ¥è¯¢
âœ… å®Œæ•´çš„çŠ¶æ€è¿½è¸ª
âœ… äº‹ä»¶é©±åŠ¨é€šçŸ¥
âœ… æ”¯æŒçŠ¶æ€æ¢å¤
```

---

## ğŸ”„ çŠ¶æ€è½¬æ¢æµç¨‹è¯¦å›¾

```
æ—¶é—´çº¿                    çŠ¶æ€é˜¶æ®µ                           æ•°æ®æ›´æ–°
  â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º [Idle]
  â”‚                      â”‚
  â”‚                      â”‚ manager.create_session()
  â”‚                      â”‚ manager.transition(Initializing)
  â”‚                      â–¼
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º [Initializing] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â€¢ session_id
  â”‚                      â”‚                                  â€¢ run_id
  â”‚                      â”‚ åŠ è½½é…ç½®                          â€¢ created_at
  â”‚                      â”‚ è§£æå‚æ•°
  â”‚                      â”‚
  â”‚                      â”‚ manager.transition(MemorySearch)
  â”‚                      â–¼
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º [MemorySearch] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â€¢ memory_hits++
  â”‚                      â”‚                                  â€¢ matches[]
  â”‚                      â”‚ memory.search()
  â”‚                      â”‚ build_merged_prompt()
  â”‚                      â”‚
  â”‚                      â”‚ manager.transition(RunnerStarting)
  â”‚                      â–¼
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º [RunnerStarting] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â€¢ runner_pid
  â”‚                      â”‚                                  â€¢ session_args
  â”‚                      â”‚ build backend plan
  â”‚                      â”‚ runner.start_session()
  â”‚                      â”‚
  â”‚                      â”‚ manager.transition(RunnerRunning)
  â”‚                      â–¼
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º [RunnerRunning] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â€¢ tool_events_count++
  â”‚                      â”‚                                  â€¢ duration_ms
  â”‚                      â”‚ run_session()
  â”‚                      â”‚   â”œâ”€ stdout/stderr tee
  â”‚                      â”‚   â”œâ”€ tool event parsing
  â”‚                      â”‚   â”‚   â””â”€> manager.update() âœ¨
  â”‚                      â”‚   â””â”€ policy check
  â”‚                      â”‚
  â”‚                      â”‚ è‡ªåŠ¨ â†’ ProcessingToolEvents
  â”‚                      â–¼
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º [ProcessingToolEvents] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â€¢ tool_events[]
  â”‚                      â”‚                                  â€¢ correlations
  â”‚                      â”‚ tool_event::correlate()
  â”‚                      â”‚ build_run_outcome()
  â”‚                      â”‚
  â”‚                      â”‚ manager.transition(GatekeeperEvaluating)
  â”‚                      â–¼
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º [GatekeeperEvaluating] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â€¢ gatekeeper_decision
  â”‚                      â”‚                                  â€¢ should_write
  â”‚                      â”‚ gatekeeper.evaluate()             â€¢ reasons[]
  â”‚                      â”‚ manager.update(decision)          â€¢ signals{}
  â”‚                      â”‚
  â”‚                      â”‚ manager.transition(MemoryPersisting)
  â”‚                      â–¼
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º [MemoryPersisting] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â€¢ candidates[]
  â”‚                      â”‚                                  â€¢ hit_payload
  â”‚                      â”‚ post_run_memory_reporting()       â€¢ validate_payloads[]
  â”‚                      â”‚   â”œâ”€ hit
  â”‚                      â”‚   â”œâ”€ validate
  â”‚                      â”‚   â””â”€ candidate
  â”‚                      â”‚
  â”‚                      â”‚ manager.complete(exit_code)
  â”‚                      â–¼
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º [Completed] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â€¢ exit_code
                         â”‚                                  â€¢ duration_ms
                         â”‚ æˆ–                                â€¢ completed_at
                         â–¼
                    [Failed] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â€¢ error_message
                                                             â€¢ failed_at
```

---

## ğŸ“¦ æ•°æ®æµå¯¹æ¯”

### æ”¹é€ å‰ï¼šå•å‘æ•°æ®æµ

```
Input (CLI Args)
    â”‚
    â–¼
Config Loading
    â”‚
    â–¼
Memory Search â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º matches (local)
    â”‚
    â–¼
Runner Start
    â”‚
    â–¼
Session Run â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º run_result (local)
    â”‚
    â–¼
Gatekeeper â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º decision (local)
    â”‚
    â–¼
Memory Report
    â”‚
    â–¼
Output (exit_code)

âŒ æ•°æ®åªèƒ½å•å‘æµåŠ¨
âŒ ä¸­é—´çŠ¶æ€ä¸å¯æŸ¥è¯¢
âŒ æ— æ³•è¿½è¸ªå†å²
```

### æ”¹é€ åï¼šåŒå‘æ•°æ®æµ + çŠ¶æ€å­˜å‚¨

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   StateManager       â”‚
                    â”‚   (Central Store)    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚         â”‚         â”‚
         write â—„â”€â”€â”€â”€â”¤    read â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”¤â”€â”€â”€â”€ subscribe
                    â”‚         â”‚         â”‚
                    â–¼         â–¼         â–¼
Input â”€â”€â”€â”€â”€â–º Config â”€â”€â”€â”€â”€â–º Memory â”€â”€â”€â”€â”€â–º Runner â”€â”€â”€â”€â”€â–º Gatekeeper â”€â”€â”€â”€â”€â–º Output
  â”‚            â”‚              â”‚            â”‚              â”‚                 â”‚
  â”‚            â–¼              â–¼            â–¼              â–¼                 â–¼
  â”‚         [Init]      [MemSearch]   [Running]    [Evaluating]       [Completed]
  â”‚            â”‚              â”‚            â”‚              â”‚                 â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Event Stream      â”‚
                    â”‚   (Observers)       â”‚
                    â”‚   â€¢ Logger          â”‚
                    â”‚   â€¢ Metrics         â”‚
                    â”‚   â€¢ Monitor         â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âœ… çŠ¶æ€å¯è¯»å†™
âœ… å®æ—¶æŸ¥è¯¢
âœ… äº‹ä»¶é€šçŸ¥
âœ… å†å²è¿½è¸ª
```

---

## ğŸ—ï¸ æ¨¡å—é›†æˆæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Application Layer                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  main.rs                                                 â”‚  â”‚
â”‚  â”‚  â€¢ åˆ›å»ºå…¨å±€ StateManager                                 â”‚  â”‚
â”‚  â”‚  â€¢ å¯åŠ¨äº‹ä»¶ç›‘å¬å™¨ï¼ˆå¯é€‰ï¼‰                                â”‚  â”‚
â”‚  â”‚  â€¢ è°ƒç”¨ run_app_with_config(state_manager)              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Business Logic Layer                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  app.rs: run_app_with_config()                          â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â”‚  1. Create Session                                       â”‚  â”‚
â”‚  â”‚     â””â”€> manager.create_session(run_id)                  â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â”‚  2. State Transitions                                    â”‚  â”‚
â”‚  â”‚     â”œâ”€> manager.transition(Initializing)                â”‚  â”‚
â”‚  â”‚     â”œâ”€> manager.transition(MemorySearch)                â”‚  â”‚
â”‚  â”‚     â”œâ”€> manager.transition(RunnerStarting)              â”‚  â”‚
â”‚  â”‚     â”œâ”€> manager.transition(RunnerRunning)               â”‚  â”‚
â”‚  â”‚     â”œâ”€> manager.transition(GatekeeperEvaluating)        â”‚  â”‚
â”‚  â”‚     â”œâ”€> manager.transition(MemoryPersisting)            â”‚  â”‚
â”‚  â”‚     â””â”€> manager.complete(exit_code)                     â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â”‚  3. Data Updates                                         â”‚  â”‚
â”‚  â”‚     â”œâ”€> manager.update(memory_hits++)                   â”‚  â”‚
â”‚  â”‚     â”œâ”€> manager.update(runner_pid)                      â”‚  â”‚
â”‚  â”‚     â”œâ”€> manager.update(tool_events++)                   â”‚  â”‚
â”‚  â”‚     â””â”€> manager.update(gatekeeper_decision)             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Core Runtime Layer                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  run.rs: run_session()                                   â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â”‚  â€¢ Receives state_manager & session_id                  â”‚  â”‚
â”‚  â”‚  â€¢ Updates state in tool event loop:                    â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â”‚    loop {                                                â”‚  â”‚
â”‚  â”‚      if let Some(ev) = tool_runtime.observe_line() {    â”‚  â”‚
â”‚  â”‚        manager.update(tool_events++) âœ¨                 â”‚  â”‚
â”‚  â”‚      }                                                   â”‚  â”‚
â”‚  â”‚    }                                                     â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â”‚  â€¢ Updates performance metrics before return            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      State Management Layer                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  state/manager.rs: StateManager                          â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚   AppState     â”‚      â”‚   Sessions                â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  (Global)      â”‚      â”‚   HashMap<Id, Session>    â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚  â”‚
â”‚  â”‚  â”‚   Event Broadcasting                                 â”‚â”‚  â”‚
â”‚  â”‚  â”‚   broadcast::Sender<StateEvent>                      â”‚â”‚  â”‚
â”‚  â”‚  â”‚     â”œâ”€> Logger                                       â”‚â”‚  â”‚
â”‚  â”‚  â”‚     â”œâ”€> Metrics Collector                            â”‚â”‚  â”‚
â”‚  â”‚  â”‚     â””â”€> Monitor Dashboard                            â”‚â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â”‚  API:                                                    â”‚  â”‚
â”‚  â”‚  â€¢ create_session()                                      â”‚  â”‚
â”‚  â”‚  â€¢ transition_phase()                                    â”‚  â”‚
â”‚  â”‚  â€¢ update_session()                                      â”‚  â”‚
â”‚  â”‚  â€¢ complete() / fail()                                   â”‚  â”‚
â”‚  â”‚  â€¢ get_session() / get_active_sessions()                â”‚  â”‚
â”‚  â”‚  â€¢ subscribe()                                           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š äº‹ä»¶æµå›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Event Generation                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚                 â”‚                  â”‚
   â–¼                 â–¼                  â–¼
[Create]        [Transition]       [Update Data]
session         phase              session
   â”‚                 â”‚                  â”‚
   â”œâ”€ SessionCreated â”‚                  â”‚
   â”‚                 â”œâ”€ StateChanged    â”‚
   â”‚                 â”‚                  â”œâ”€ ToolEventReceived
   â”‚                 â”‚                  â”œâ”€ MemoryHit
   â”‚                 â”‚                  â””â”€ GatekeeperDecision
   â”‚                 â”‚                  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            StateManager (Event Broadcaster)                   â”‚
â”‚                broadcast::Sender<StateEvent>                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â”‚ broadcast (multi-consumer)
                     â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚                 â”‚                 â”‚                 â”‚
   â–¼                 â–¼                 â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Logger  â”‚    â”‚ Metrics  â”‚    â”‚ Monitor  â”‚    â”‚  Custom  â”‚
â”‚         â”‚    â”‚Collector â”‚    â”‚ Dashboardâ”‚    â”‚ Observer â”‚
â”‚         â”‚    â”‚          â”‚    â”‚          â”‚    â”‚          â”‚
â”‚ tracing â”‚    â”‚ Prom/IM  â”‚    â”‚ Web UI   â”‚    â”‚  ...     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ é”™è¯¯å¤„ç†æµç¨‹

### æ”¹é€ å‰

```
run_app_with_config()
    â”‚
    â”œâ”€ config.load() â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Error â”€â”€â”
    â”‚                                     â”‚
    â”œâ”€ memory.search() â”€â”€â”€â”€â”€â”€â”€â”€â–º Error â”€â”€â”¤
    â”‚                                     â”‚
    â”œâ”€ runner.start() â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Error â”€â”€â”¤
    â”‚                                     â”‚
    â””â”€ run_session() â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Error â”€â”€â”¤
                                          â”‚
                                          â””â”€â”€â–º return Err(e)
                                                    â”‚
                                                    â–¼
                                              main.rs é€€å‡º

âŒ é”™è¯¯å‘ç”ŸåçŠ¶æ€ä¸¢å¤±
âŒ æ— æ³•æŸ¥è¯¢å¤±è´¥åŸå› 
âŒ è°ƒè¯•å›°éš¾
```

### æ”¹é€ å

```
run_app_with_config(state_manager)
    â”‚
    â”œâ”€ session_id = manager.create_session() âœ…
    â”‚                                          â”‚
    â”œâ”€ config.load() â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Error â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚                                â”‚         â”‚
    â”‚                                â–¼         â”‚
    â”‚                    manager.fail(session_id, error) âœ…
    â”‚                                â”‚         â”‚
    â”œâ”€ memory.search() â”€â”€â”€â”€â”€â”€â”€â”€â–º Error â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚                                â”‚         â”‚
    â”‚                                â–¼         â”‚
    â”‚                    manager.fail(session_id, error) âœ…
    â”‚                                â”‚         â”‚
    â”œâ”€ runner.start() â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Error â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚                                â”‚         â”‚
    â”‚                                â–¼         â”‚
    â”‚                    manager.fail(session_id, error) âœ…
    â”‚                                â”‚         â”‚
    â””â”€ run_session() â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Error â”€â”€â”€â”€â”€â”€â”€â”¤
                                     â”‚         â”‚
                                     â–¼         â”‚
                         manager.fail(session_id, error) âœ…
                                     â”‚         â”‚
                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â–º return Err(e)
                                                         â”‚
                                                         â–¼
                                                   main.rs é€€å‡º
                                                         â”‚
                                           BUT âœ¨ çŠ¶æ€å·²ä¿å­˜
                                           â€¢ session.status = Failed
                                           â€¢ session.error = error_msg
                                           â€¢ å¯æŸ¥è¯¢ã€å¯æ¢å¤

âœ… å¤±è´¥çŠ¶æ€è¢«è®°å½•
âœ… å¯æŸ¥è¯¢å¤±è´¥è¯¦æƒ…
âœ… æ”¯æŒæ•…éšœåˆ†æ
âœ… æ”¯æŒçŠ¶æ€æ¢å¤
```

---

## ğŸ“ˆ æ€§èƒ½å½±å“åˆ†æ

```
                      æ”¹é€ å‰                  æ”¹é€ å
                        â”‚                      â”‚
æ“ä½œå»¶è¿Ÿ               0ms                   < 1ms
                        â”‚                      â”‚
                        â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚    â”‚ RwLock è¯»å†™
                        â”‚    â”‚ Event broadcast
                        â”‚    â””â”€ å¼‚æ­¥æ›´æ–°ï¼ˆä¸é˜»å¡ï¼‰
                        â”‚
å†…å­˜å ç”¨            Baseline             +5-10MB per session
                        â”‚                      â”‚
                        â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚    â”‚ SessionState
                        â”‚    â”‚ RuntimeState
                        â”‚    â””â”€ Metrics
                        â”‚
CPU å¼€é”€                ~0%                  < 1%
                        â”‚                      â”‚
                        â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚    â”‚ çŠ¶æ€æ›´æ–°
                        â”‚    â”‚ äº‹ä»¶å‘é€
                        â”‚    â””â”€ é”ç«äº‰ï¼ˆminimalï¼‰

ç»“è®ºï¼šæ€§èƒ½å½±å“å¯å¿½ç•¥ä¸è®¡ âœ…
```

---

## ğŸ¯ æ€»ç»“

### å…³é”®æ”¹è¿›

| æ–¹é¢ | æ”¹é€ å‰ | æ”¹é€ å |
|------|--------|--------|
| **çŠ¶æ€å¯è§æ€§** | âŒ ä¸å¯è§ | âœ… å®æ—¶å¯æŸ¥ |
| **è°ƒè¯•èƒ½åŠ›** | âŒ å›°éš¾ | âœ… å®Œæ•´è¿½è¸ª |
| **æ•…éšœæ¢å¤** | âŒ ä¸æ”¯æŒ | âœ… å¿«ç…§æ¢å¤ |
| **å¯è§‚æµ‹æ€§** | âŒ æœ‰é™ | âœ… äº‹ä»¶é©±åŠ¨ |
| **æµ‹è¯•å‹å¥½** | âŒ è€¦åˆ | âœ… è§£è€¦ |

### å®æ–½è¦ç‚¹

1. âœ… **æœ€å°ä¾µå…¥**ï¼šåªæ·»åŠ å‚æ•°å’ŒçŠ¶æ€æ›´æ–°è°ƒç”¨
2. âœ… **å‘åå…¼å®¹**ï¼šstate_manager å¯é€‰
3. âœ… **æ€§èƒ½ä¼˜åŒ–**ï¼šå¼‚æ­¥æ›´æ–°ï¼Œä¸é˜»å¡ä¸»æµç¨‹
4. âœ… **æ¸è¿›å¼**ï¼šå¯åˆ†é˜¶æ®µå¯ç”¨åŠŸèƒ½

### ä¸‹ä¸€æ­¥

å‚è§ï¼š
- [é›†æˆæ–¹æ¡ˆ](STATE-INTEGRATION-PLAN.md) - è¯¦ç»†å®æ–½è®¡åˆ’
- [ä»£ç ç¤ºä¾‹](STATE-INTEGRATION-CODE-EXAMPLES.md) - å…·ä½“ä»£ç æ”¹é€ 
- [å®æ–½æ¸…å•](STATE-INTEGRATION-CHECKLIST.md) - ä»»åŠ¡æ£€æŸ¥åˆ—è¡¨
